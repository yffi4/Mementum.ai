# Интеграция календаря с заметками

## Обзор

Теперь Memetum.ai поддерживает полную интеграцию с Google Calendar! AI агент автоматически анализирует ваши заметки и создает события календаря, когда обнаруживает временные маркеры.

## Ключевые функции

### 1. Автоматическое создание событий календаря

- При создании или обновлении заметки AI агент анализирует текст
- Если находит упоминания о встречах, дедлайнах или событиях с датами/временем
- Автоматически создает соответствующие события в Google Calendar

### 2. Google OAuth авторизация

- Простая авторизация через Google аккаунт
- Безопасное хранение токенов в базе данных
- Автоматическое обновление токенов

### 3. Интеграция в эндпоинт заметок

- Все календарные функции доступны через `/notes`
- Просмотр событий календаря связанных с заметками
- Управление календарем через API заметок

## API Эндпоинты

### Авторизация

- `GET /auth/google` - Перенаправление на Google OAuth
- `GET /auth/google/callback` - Callback от Google
- `GET /auth/status` - Статус авторизации пользователя
- `DELETE /auth/google/disconnect` - Отключить Google аккаунт

### Календарь (через /notes)

- `GET /notes/calendar/calendars` - Список календарей
- `GET /notes/calendar/events` - События календаря
- `POST /notes/calendar/events` - Создать событие
- `GET /notes/calendar/user-info` - Информация о пользователе

### События связанные с заметками

- `GET /notes/{note_id}/calendar-events` - События для заметки
- `POST /notes/{note_id}/analyze-calendar` - Принудительный анализ заметки

## Примеры распознавания AI

AI агент распознает следующие типы временных выражений:

### Ключевые слова

- встреча, собрание, конференция, презентация
- звонок, разговор, обсуждение, планерка
- напомни, напоминание, дедлайн, срок
- врач, доктор, прием, визит

### Временные паттерны

- "завтра в 15:00"
- "встреча 25.12.2024 в 10 утра"
- "звонок через 2 дня"
- "дедлайн в пятницу"

### Примеры заметок

```
Встреча с клиентом завтра в 14:00 в офисе
→ Создаст событие: "Встреча с клиентом" на завтра 14:00-15:00

Напомни созвониться с Иваном в четверг в 16:30
→ Создаст событие: "Созвониться с Иваном" в четверг 16:30-17:00

Дедлайн по проекту 30.12.2024
→ Создаст событие: "Дедлайн по проекту" на 30.12.2024 в 18:00
```

## Настройка

### Backend

1. Добавьте Google OAuth credentials в `.env`:

```env
GOOGLE_CLIENT_ID=your_client_id
GOOGLE_CLIENT_SECRET=your_client_secret
GOOGLE_REDIRECT_URI=http://localhost:8000/auth/google/callback
```

2. Создайте миграцию базы данных:

```bash
alembic revision --autogenerate -m "Add Google OAuth and calendar integration"
alembic upgrade head
```

### Frontend

1. Обновите API URL в `authApi.ts` если необходимо
2. Новая страница логина поддерживает Google OAuth
3. CalendarPage показывает интегрированный календарь

## Модели базы данных

### GoogleToken

Хранит OAuth токены пользователей:

- access_token, refresh_token
- expires_at для автоматического обновления
- scope для управления правами доступа

### NoteCalendarEvent

Связывает заметки с событиями календаря:

- note_id - ID заметки
- google_event_id - ID события в Google Calendar
- event_title, start_datetime, end_datetime
- created_by_ai - флаг создания AI агентом

### User (обновлен)

Добавлены поля для Google OAuth:

- google_id, google_email, google_name, google_picture
- hashed_password теперь nullable (для пользователей только с Google auth)

## Безопасность

- Токены шифруются в базе данных
- Автоматическое обновление истекших токенов
- Scope ограничен только календарем и профилем
- JWT токены для аутентификации в приложении

## Workflow

1. Пользователь авторизуется через Google OAuth
2. Создает заметку с временными маркерами
3. AI агент анализирует текст заметки
4. Создает события в Google Calendar
5. Сохраняет связи в базе данных
6. Пользователь видит события в календаре и в интерфейсе заметок

Это обеспечивает seamless интеграцию между заметками и календарем!
